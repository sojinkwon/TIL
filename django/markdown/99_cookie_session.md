[toc]

# Cookie_Session

## HTTP

> https://developer.mozilla.org/ko/docs/Web/HTTP/Overview

- HTML 문서와 같은 리소스들을 가져올 수 있도록 해주는 프로토콜(규칙, 약속)
- 웹에서 이루어지는 모든 데이터 교환의 기초



**HTTP의 대표 특성**

- 비연결지향(connectionless) : 서버는 응답하고 접속을 끊음
- 상태정보 유지안함(stateless, 무상태) : 접속이 끊어지면 클라이언트와 서버간의 통신이 끝나며 상태를 저장하지않음
- 클라이언트와 서버 사이의 메세지가 완벽하게 각각 독립적

<br>

## 쿠키(Cookie)

- 클라이언트의 로컬에 저장되는 키-값의 작은 데이터 파일(이름, 값, 만료 날짜, 경로 정보). 
- 일정시간 동안 데이터 저장 가능.
- 웹페이지에 접속하면 요청한 웹페이지를 받으며 쿠키를 로컬에 저장하고, 클라이언트가 재 요청시마다 웹페이지 요청과 함께 쿠키 값도 함께 전송
- 아이디 자동완성, 공지메세지 하루 안보기, 팝업 체크, 비로그인 장바구니 담기 등 편의를 위하되 지워지거나 유출 되도 큰 일은 없을 정보들을 저장

<br>

## 세션(Session)

- 사이트와 특정 브라우저 사이의 **state(상태)**를 유지시키는 것
- 클라이언트가 서버에 접속하면 서버가 특정 `session id`를 발급하고 클라이언트는 session id를 쿠키를 이용해 저장. 클라이언트가 다시 서버에 요청할 때 마다 해당 쿠키(session id가 저장된)를 이용해 서버에 session id를 전달
  - 세션을 구별하기 위해 ID가 필요하고 **해당 ID만 쿠키를 이용해 저장**
  - 쿠키는 자동으로 서버에 전송되니 서버에서 session id에 따른 처리를 할 수 있음
- Django 는 특정 session id 를 포함하는 쿠키를 사용해서 각각의 브라우저와 사이트가 연결된 세션을 알아냄
- session data는 django DB의 django_session 테이블에 저장. (이는 쿠키 안에 데이터를 저장하는 것보다 더 보안에 유리하고, 상대적으로 쿠키는 악의적인 사용자에게 취약하기 때문. 단, 쿠키가 절대 보안력이 약하다는 의미가 아니다.)
- 세션을 남발하면 사용자가 많을 때 서버에 부하가 걸림

- 아래처럼 세션에 대한 유효기간을 설정하고 갱신할 수도 있음

  > https://docs.djangoproject.com/ko/3.1/ref/settings/#sessions

  ```python
  # settings.py
  
  DAY_IN_SECONDS = 86400
  SESSION_COOKIE_AGE = DAY_IN_SECONDS
  
  # 클라이언트가 요청을 보낼때마다 세션 만료 시간이 갱신
  SESSION_SAVE_EVERY_REQUEST = True
  ```



---



**쿠키**

- 클라이언트 로컬에 파일로 저장

**세션**

- 서버에 저장 (이때 session id 는 쿠키의 형태로 클라이언트 로컬에 저장)

<br>

> HTTP 쿠키는 상태가 있는 세션을 만들도록 해준다.